<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Money Manager Admin</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" type="image/png" href="logo_app_96.png">
    <!-- Chart.js for statistics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <img src="logo_app_96.png" alt="Logo" class="nav-logo">
                <div class="brand-text">
                    <span class="brand-name">Money Manager</span>
                    <span class="brand-subtitle">Admin Dashboard</span>
                </div>
            </div>
            
            <div class="nav-controls">
                <div class="user-info" id="userInfo">
                    <i class="fas fa-user-circle"></i>
                    <div class="user-details">
                        <span class="user-name" id="userName">Loading...</span>
                        <span class="user-role" id="userRole">Role</span>
                    </div>
                </div>
                <button class="btn btn-secondary" id="notificationsBtn" title="Notifications">
                    <i class="fas fa-bell"></i>
                    <span class="badge" id="notificationCount">0</span>
                </button>
                <button class="btn btn-danger" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i>
                    Logout
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <nav class="sidebar-nav">
                <ul>
                    <li class="active">
                        <a href="dashboard.html">
                            <i class="fas fa-tachometer-alt"></i>
                            <span>Dashboard</span>
                        </a>
                    </li>
                    <li>
                        <a href="users.html">
                            <i class="fas fa-users"></i>
                            <span>Users</span>
                            <span class="badge" id="usersCount">0</span>
                        </a>
                    </li>
                    <li>
                        <a href="employees.html">
                            <i class="fas fa-user-tie"></i>
                            <span>Employees</span>
                            <span class="badge" id="employeesCount">0</span>
                        </a>
                    </li>
                    <li>
                        <a href="profiles.html">
                            <i class="fas fa-id-card"></i>
                            <span>Profiles</span>
                        </a>
                    </li>
                    <li class="section-header">Financial Data</li>
                    <li>
                        <a href="incomes.html">
                            <i class="fas fa-money-bill-wave"></i>
                            <span>Incomes</span>
                            <span class="badge" id="incomesCount">0</span>
                        </a>
                    </li>
                    <li>
                        <a href="expenses.html">
                            <i class="fas fa-shopping-cart"></i>
                            <span>Expenses</span>
                            <span class="badge" id="expensesCount">0</span>
                        </a>
                    </li>
                    <li class="section-header">Categories</li>
                    <li>
                        <a href="categories.html">
                            <i class="fas fa-tags"></i>
                            <span>Expense Categories</span>
                            <span class="badge" id="categoriesCount">0</span>
                        </a>
                    </li>
                    <li>
                        <a href="income-categories.html">
                            <i class="fas fa-chart-line"></i>
                            <span>Income Categories</span>
                            <span class="badge" id="incomeCategoriesCount">0</span>
                        </a>
                    </li>
                    <li>
                        <a href="preferences.html">
                            <i class="fas fa-cog"></i>
                            <span>Preferences</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Welcome Header -->
            <div class="welcome-header">
                <h1>Welcome back, <span id="greetingName">Admin</span></h1>
                <p class="last-login">Last login: <span id="lastLoginTime">Today at 00:00</span></p>
            </div>

            <!-- Statistics Grid -->
            <div class="stats-grid">
                <!-- Total Users Card -->
                <div class="stat-card">
                    <div class="stat-header">
                        <h3>Total Users</h3>
                        <div class="stat-icon users">
                            <i class="fas fa-users"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="statTotalUsers">0</div>
                    <div class="stat-change positive">
                        <i class="fas fa-arrow-up"></i>
                        <span id="usersChange">0%</span> from last month
                    </div>
                    <a href="users.html" class="stat-link">View all users <i class="fas fa-arrow-right"></i></a>
                </div>

                <!-- Total Employees Card -->
                <div class="stat-card">
                    <div class="stat-header">
                        <h3>Employees</h3>
                        <div class="stat-icon employees">
                            <i class="fas fa-user-tie"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="statTotalEmployees">0</div>
                    <div class="stat-change">
                        <i class="fas fa-info-circle"></i>
                        <span id="activeEmployees">0</span> active
                    </div>
                    <a href="employees.html" class="stat-link">Manage employees <i class="fas fa-arrow-right"></i></a>
                </div>

                <!-- Total Income Card -->
                <div class="stat-card">
                    <div class="stat-header">
                        <h3>Total Income</h3>
                        <div class="stat-icon income">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="statTotalIncome">$0</div>
                    <div class="stat-change positive">
                        <i class="fas fa-arrow-up"></i>
                        <span id="incomeChange">0%</span> this month
                    </div>
                    <a href="incomes.html" class="stat-link">View income reports <i class="fas fa-arrow-right"></i></a>
                </div>

                <!-- Total Expenses Card -->
                <div class="stat-card">
                    <div class="stat-header">
                        <h3>Total Expenses</h3>
                        <div class="stat-icon expenses">
                            <i class="fas fa-shopping-cart"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="statTotalExpenses">$0</div>
                    <div class="stat-change negative">
                        <i class="fas fa-arrow-down"></i>
                        <span id="expensesChange">0%</span> this month
                    </div>
                    <a href="expenses.html" class="stat-link">View expense reports <i class="fas fa-arrow-right"></i></a>
                </div>
            </div>

            <!-- Charts Section -->
            <div class="charts-section">
                <div class="chart-card">
                    <div class="chart-header">
                        <h3>Income vs Expenses (Last 6 Months)</h3>
                        <select id="chartPeriod" class="chart-select">
                            <option value="6">Last 6 Months</option>
                            <option value="3">Last 3 Months</option>
                            <option value="12">Last 12 Months</option>
                        </select>
                    </div>
                    <div class="chart-container">
                        <canvas id="incomeExpensesChart"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <div class="chart-header">
                        <h3>Top Expense Categories</h3>
                    </div>
                    <div class="chart-container">
                        <canvas id="expenseCategoriesChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Recent Activity Section -->
            <div class="activity-section">
                <div class="section-header">
                    <h3>Recent Activity</h3>
                    <button class="btn btn-secondary" id="refreshActivityBtn">
                        <i class="fas fa-redo"></i> Refresh
                    </button>
                </div>
                
                <div class="activity-tabs">
                    <button class="tab-btn active" data-tab="recent-users">New Users</button>
                    <button class="tab-btn" data-tab="recent-incomes">Recent Incomes</button>
                    <button class="tab-btn" data-tab="recent-expenses">Recent Expenses</button>
                </div>

                <div class="activity-content">
                    <!-- Recent Users Table -->
                    <div class="tab-content active" id="recent-users">
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Email</th>
                                        <th>Join Date</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="recentUsersTable">
                                    <tr>
                                        <td colspan="4" class="loading-row">
                                            <i class="fas fa-spinner fa-spin"></i> Loading data...
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Recent Incomes Table -->
                    <div class="tab-content" id="recent-incomes">
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>User</th>
                                        <th>Amount</th>
                                        <th>Category</th>
                                        <th>Date</th>
                                    </tr>
                                </thead>
                                <tbody id="recentIncomesTable">
                                    <tr>
                                        <td colspan="4" class="loading-row">
                                            <i class="fas fa-spinner fa-spin"></i> Loading data...
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Recent Expenses Table -->
                    <div class="tab-content" id="recent-expenses">
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>User</th>
                                        <th>Amount</th>
                                        <th>Category</th>
                                        <th>Date</th>
                                    </tr>
                                </thead>
                                <tbody id="recentExpensesTable">
                                    <tr>
                                        <td colspan="4" class="loading-row">
                                            <i class="fas fa-spinner fa-spin"></i> Loading data...
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="quick-actions">
                <h3>Quick Actions</h3>
                <div class="actions-grid">
                    <button class="action-card" id="addUserBtn">
                        <i class="fas fa-user-plus"></i>
                        <span>Add New User</span>
                    </button>
                    <button class="action-card" id="addEmployeeBtn">
                        <i class="fas fa-user-tie"></i>
                        <span>Add Employee</span>
                    </button>
                    <button class="action-card" id="addIncomeBtn">
                        <i class="fas fa-money-bill-wave"></i>
                        <span>Record Income</span>
                    </button>
                    <button class="action-card" id="addExpenseBtn">
                        <i class="fas fa-receipt"></i>
                        <span>Record Expense</span>
                    </button>
                    <button class="action-card" id="manageBudgetsBtn">
                        <i class="fas fa-chart-pie"></i>
                        <span>Manage Budgets</span>
                    </button>
                    <button class="action-card" id="manageGoalsBtn">
                        <i class="fas fa-bullseye"></i>
                        <span>Manage Goals</span>
                    </button>
                    <button class="action-card" id="viewNotificationsBtn">
                        <i class="fas fa-bell"></i>
                        <span>View Notifications</span>
                        <span class="badge" id="dashboardNotificationCount">0</span>
                    </button>
                    <button class="action-card" id="generateReportBtn">
                        <i class="fas fa-chart-pie"></i>
                        <span>Generate Report</span>
                    </button>
                    <button class="action-card" id="systemSettingsBtn">
                        <i class="fas fa-cogs"></i>
                        <span>System Settings</span>
                    </button>
                </div>
            </div>

            <!-- Smart Insights -->
            <div class="insights-section">
                <div class="section-header">
                    <h3><i class="fas fa-lightbulb"></i> Smart Insights</h3>
                    <button class="btn btn-secondary" id="refreshInsightsBtn">
                        <i class="fas fa-redo"></i> Refresh
                    </button>
                </div>
                
                <div class="insights-grid" id="insightsGrid">
                    <div class="insight-card">
                        <div class="insight-header">
                            <div class="insight-icon">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div>
                                <h4>Spending Trend</h4>
                                <span class="insight-tag positive">+12%</span>
                            </div>
                        </div>
                        <div class="insight-content">
                            <p>Your spending increased by 12% compared to last month. Food expenses saw the highest increase.</p>
                        </div>
                        <div class="insight-actions">
                            <button class="btn btn-sm btn-primary" onclick="window.location.href='expenses.html'">
                                View Details
                            </button>
                        </div>
                    </div>

                    <div class="insight-card">
                        <div class="insight-header">
                            <div class="insight-icon">
                                <i class="fas fa-piggy-bank"></i>
                            </div>
                            <div>
                                <h4>Savings Opportunity</h4>
                                <span class="insight-tag warning">Potential</span>
                            </div>
                        </div>
                        <div class="insight-content">
                            <p>You could save $150/month by reducing entertainment and dining out expenses by 20%.</p>
                        </div>
                        <div class="insight-actions">
                            <button class="btn btn-sm btn-primary" onclick="window.location.href='budgets.html'">
                                Set Budget
                            </button>
                        </div>
                    </div>

                    <div class="insight-card">
                        <div class="insight-header">
                            <div class="insight-icon">
                                <i class="fas fa-bullseye"></i>
                            </div>
                            <div>
                                <h4>Goal Progress</h4>
                                <span class="insight-tag success">65%</span>
                            </div>
                        </div>
                        <div class="insight-content">
                            <p>You're 65% towards your emergency fund goal. At this rate, you'll reach it in 3 months.</p>
                        </div>
                        <div class="insight-actions">
                            <button class="btn btn-sm btn-primary" onclick="window.location.href='goals.html'">
                                View Goals
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Notifications Panel -->
    <div class="notifications-panel" id="notificationsPanel">
        <div class="notifications-header">
            <h3>Notifications</h3>
            <button class="close-notifications" id="closeNotificationsBtn">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="notifications-list" id="notificationsList">
            <div class="notification-empty">
                <i class="fas fa-bell-slash"></i>
                <p>No notifications yet</p>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    
    <!-- App Scripts -->
    <script src="config.js"></script>
    <script src="firebase-config.js"></script>
    <script src="auth.js"></script>
    
    <!-- Dashboard Script -->
    <script>
        console.log('ðŸ“Š Dashboard page loaded');
        
        // Global variables
        let auth, db;
        let currentUser = null;
        let authChecked = false;
        
        // Initialize dashboard
        async function initializeDashboard() {
            console.log('ðŸ”„ Initializing dashboard...');
            
            try {
                // Check if we should be here
                if (window.location.pathname.includes('dashboard.html')) {
                    console.log('ðŸ“ Properly on dashboard page');
                }
                
                // Wait for authSystem to be ready
                if (window.authSystem) {
                    console.log('âœ… authSystem found');
                    
                    // Get auth and db from authSystem
                    auth = window.authSystem.getAuth();
                    db = window.authSystem.getDB();
                    
                    if (auth && db) {
                        console.log('âœ… Got auth and db from authSystem');
                        await checkAuthentication();
                    } else {
                        console.warn('âš ï¸ authSystem not fully ready, initializing manually...');
                        await initializeFirebaseManually();
                    }
                } else {
                    console.warn('âš ï¸ authSystem not found, initializing manually...');
                    await initializeFirebaseManually();
                }
                
            } catch (error) {
                console.error('âŒ Dashboard initialization error:', error);
                showError('Failed to initialize dashboard. Please refresh.');
            }
        }
        
        async function initializeFirebaseManually() {
            console.log('âš¡ Initializing Firebase manually...');
            
            // Check if Firebase is loaded
            if (typeof firebase === 'undefined') {
                console.error('âŒ Firebase not loaded');
                redirectToLogin();
                return;
            }
            
            // Check if config is available
            if (!window.firebaseConfig) {
                console.error('âŒ Firebase config not loaded');
                redirectToLogin();
                return;
            }
            
            try {
                // Initialize Firebase if not already initialized
                if (!firebase.apps.length) {
                    console.log('ðŸš€ Initializing Firebase app...');
                    firebase.initializeApp(window.firebaseConfig);
                } else {
                    console.log('âœ… Firebase already initialized');
                }
                
                auth = firebase.auth();
                db = firebase.firestore();
                
                console.log('âœ… Firebase initialized successfully');
                await checkAuthentication();
                
            } catch (error) {
                console.error('âŒ Firebase manual initialization error:', error);
                redirectToLogin();
            }
        }
        
        async function checkAuthentication() {
            console.log('ðŸ” Checking authentication...');
            
            if (authChecked) {
                console.log('âœ… Authentication already checked');
                return;
            }
            
            try {
                // Check auth state
                auth.onAuthStateChanged(async (user) => {
                    console.log('ðŸ”„ Auth state changed:', user ? 'User present' : 'No user');
                    
                    if (!user) {
                        console.log('ðŸ‘¤ No authenticated user, redirecting to login...');
                        redirectToLogin();
                        return;
                    }
                    
                    // User is authenticated, verify employee status
                    console.log('ðŸ‘¤ User authenticated:', user.email);
                    
                    try {
                        const employeeDoc = await db.collection('employees').doc(user.uid).get();
                        
                        if (!employeeDoc.exists) {
                            console.error('âŒ Employee not found in database');
                            await auth.signOut();
                            redirectToLogin();
                            return;
                        }
                        
                        const employeeData = employeeDoc.data();
                        console.log('ðŸ“‹ Employee data loaded:', {
                            name: employeeData.name,
                            role: employeeData.role,
                            status: employeeData.status
                        });
                        
                        if (employeeData.status !== 'active') {
                            console.error('âŒ Employee account inactive');
                            await auth.signOut();
                            redirectToLogin();
                            return;
                        }
                        
                        // Set current user
                        currentUser = {
                            id: user.uid,
                            email: user.email,
                            ...employeeData
                        };
                        
                        console.log('âœ… User verified successfully:', currentUser.email);
                        
                        // Mark auth as checked
                        authChecked = true;
                        
                        // Initialize dashboard UI
                        initializeDashboardUI();
                        
                    } catch (error) {
                        console.error('âŒ Error verifying employee:', error);
                        redirectToLogin();
                    }
                });
                
                // Also check current user immediately
                const user = auth.currentUser;
                if (!user) {
                    console.log('ðŸ‘¤ No current user, waiting for auth state change...');
                } else {
                    console.log('ðŸ‘¤ Current user found:', user.email);
                }
                
            } catch (error) {
                console.error('âŒ Authentication check error:', error);
                redirectToLogin();
            }
        }
        
        function initializeDashboardUI() {
            console.log('ðŸŽ¨ Initializing dashboard UI...');
            
            try {
                // Update user info
                if (currentUser) {
                    document.getElementById('userName').textContent = currentUser.name || currentUser.email;
                    document.getElementById('userRole').textContent = currentUser.role || 'Employee';
                    document.getElementById('greetingName').textContent = currentUser.name?.split(' ')[0] || currentUser.email.split('@')[0];
                    
                    // Format last login time
                    if (currentUser.lastLogin) {
                        const lastLogin = currentUser.lastLogin.toDate();
                        document.getElementById('lastLoginTime').textContent = 
                            lastLogin.toLocaleDateString() + ' at ' + lastLogin.toLocaleTimeString();
                    }
                }
                
                // Setup event listeners
                setupEventListeners();
                
                // Load dashboard data
                loadDashboardData();
                
                console.log('âœ… Dashboard UI initialized');
                
            } catch (error) {
                console.error('âŒ Dashboard UI initialization error:', error);
            }
        }
        
        function setupEventListeners() {
            console.log('ðŸ”— Setting up event listeners...');
            
            // Logout button
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', async () => {
                    console.log('ðŸšª Logout requested');
                    
                    try {
                        if (window.authSystem) {
                            await window.authSystem.logout();
                        } else if (auth) {
                            await auth.signOut();
                        }
                        redirectToLogin();
                    } catch (error) {
                        console.error('âŒ Logout error:', error);
                        redirectToLogin();
                    }
                });
            }
            
            // Notifications button
            const notificationsBtn = document.getElementById('notificationsBtn');
            if (notificationsBtn) {
                notificationsBtn.addEventListener('click', () => {
                    console.log('ðŸ”” Notifications clicked');
                    toggleNotificationsPanel();
                });
            }
            
            // Close notifications button
            const closeNotificationsBtn = document.getElementById('closeNotificationsBtn');
            if (closeNotificationsBtn) {
                closeNotificationsBtn.addEventListener('click', () => {
                    console.log('âŒ Closing notifications');
                    closeNotificationsPanel();
                });
            }
            
            // Refresh activity button
            const refreshActivityBtn = document.getElementById('refreshActivityBtn');
            if (refreshActivityBtn) {
                refreshActivityBtn.addEventListener('click', () => {
                    console.log('ðŸ”„ Refreshing activity');
                    loadRecentActivity();
                });
            }
            
            // Tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const tab = btn.getAttribute('data-tab');
                    console.log('ðŸ“ Switching to tab:', tab);
                    switchTab(tab);
                });
            });
            
            // Quick action buttons
            document.querySelectorAll('.action-card').forEach(btn => {
                btn.addEventListener('click', () => {
                    const id = btn.getAttribute('id');
                    console.log('âš¡ Quick action:', id);
                    handleQuickAction(id);
                });
            });
            
            console.log('âœ… Event listeners setup complete');
        }
        
        function redirectToLogin() {
            console.log('ðŸ”€ Redirecting to login page...');
            window.location.href = 'index.html';
        }
        
        function toggleNotificationsPanel() {
            const panel = document.getElementById('notificationsPanel');
            if (panel) {
                panel.classList.toggle('show');
            }
        }
        
        function closeNotificationsPanel() {
            const panel = document.getElementById('notificationsPanel');
            if (panel) {
                panel.classList.remove('show');
            }
        }
        
        function switchTab(tabId) {
            // Remove active class from all tabs
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Remove active class from all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Add active class to selected tab
            const activeTabBtn = document.querySelector(`.tab-btn[data-tab="${tabId}"]`);
            if (activeTabBtn) {
                activeTabBtn.classList.add('active');
            }
            
            // Show selected tab content
            const activeTabContent = document.getElementById(tabId);
            if (activeTabContent) {
                activeTabContent.classList.add('active');
            }
            
            // Load data for the tab if needed
            loadTabData(tabId);
        }
        
        function handleQuickAction(actionId) {
            console.log('âš¡ Handling quick action:', actionId);
            
            const actions = {
                'addUserBtn': () => window.location.href = 'users.html?action=add',
                'addEmployeeBtn': () => window.location.href = 'employees.html?action=add',
                'addIncomeBtn': () => window.location.href = 'incomes.html?action=add',
                'addExpenseBtn': () => window.location.href = 'expenses.html?action=add',
                'manageBudgetsBtn': () => alert('Budget management coming soon!'),
                'manageGoalsBtn': () => alert('Goal management coming soon!'),
                'viewNotificationsBtn': () => toggleNotificationsPanel(),
                'generateReportBtn': () => alert('Report generation coming soon!'),
                'systemSettingsBtn': () => window.location.href = 'preferences.html'
            };
            
            if (actions[actionId]) {
                actions[actionId]();
            } else {
                console.warn('Unknown action:', actionId);
            }
        }
        
        async function loadDashboardData() {
            console.log('ðŸ“Š Loading dashboard data...');
            
            try {
                // Load statistics
                await loadStatistics();
                
                // Load recent activity
                loadRecentActivity();
                
                // Load charts
                loadCharts();
                
                // Load notifications count
                loadNotificationsCount();
                
                console.log('âœ… Dashboard data loaded');
                
            } catch (error) {
                console.error('âŒ Error loading dashboard data:', error);
            }
        }
        
        async function loadStatistics() {
            console.log('ðŸ“ˆ Loading statistics...');
            
            try {
                // Simulate loading statistics
                document.getElementById('statTotalUsers').textContent = '24';
                document.getElementById('statTotalEmployees').textContent = '8';
                document.getElementById('statTotalIncome').textContent = '$15,420';
                document.getElementById('statTotalExpenses').textContent = '$9,870';
                
                // Update counts in sidebar
                document.getElementById('usersCount').textContent = '24';
                document.getElementById('employeesCount').textContent = '8';
                document.getElementById('incomesCount').textContent = '142';
                document.getElementById('expensesCount').textContent = '89';
                
                console.log('âœ… Statistics loaded');
                
            } catch (error) {
                console.error('âŒ Error loading statistics:', error);
            }
        }
        
        function loadRecentActivity() {
            console.log('ðŸ“ Loading recent activity...');
            
            // Simulate loading data
            setTimeout(() => {
                // Recent users table
                const usersTable = document.getElementById('recentUsersTable');
                if (usersTable) {
                    usersTable.innerHTML = `
                        <tr>
                            <td>John Doe</td>
                            <td>john@example.com</td>
                            <td>2024-01-15</td>
                            <td><span class="status active">Active</span></td>
                        </tr>
                        <tr>
                            <td>Jane Smith</td>
                            <td>jane@example.com</td>
                            <td>2024-01-14</td>
                            <td><span class="status active">Active</span></td>
                        </tr>
                    `;
                }
                
                console.log('âœ… Recent activity loaded');
            }, 1000);
        }
        
        function loadCharts() {
            console.log('ðŸ“Š Loading charts...');
            
            // Initialize charts after a short delay
            setTimeout(() => {
                try {
                    // Income vs Expenses Chart
                    const incomeExpensesCtx = document.getElementById('incomeExpensesChart');
                    if (incomeExpensesCtx) {
                        new Chart(incomeExpensesCtx.getContext('2d'), {
                            type: 'line',
                            data: {
                                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                                datasets: [
                                    {
                                        label: 'Income',
                                        data: [12000, 19000, 15000, 25000, 22000, 30000],
                                        borderColor: 'rgb(75, 192, 192)',
                                        backgroundColor: 'rgba(75, 192, 192, 0.2)'
                                    },
                                    {
                                        label: 'Expenses',
                                        data: [8000, 12000, 10000, 18000, 15000, 22000],
                                        borderColor: 'rgb(255, 99, 132)',
                                        backgroundColor: 'rgba(255, 99, 132, 0.2)'
                                    }
                                ]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false
                            }
                        });
                    }
                    
                    console.log('âœ… Charts loaded');
                    
                } catch (error) {
                    console.error('âŒ Error loading charts:', error);
                }
            }, 1500);
        }
        
        function loadNotificationsCount() {
            console.log('ðŸ”” Loading notifications count...');
            
            // Simulate notifications count
            const count = 3;
            document.getElementById('notificationCount').textContent = count;
            document.getElementById('dashboardNotificationCount').textContent = count;
        }
        
        function loadTabData(tabId) {
            console.log('ðŸ“ Loading tab data for:', tabId);
            
            // Simulate loading tab-specific data
            setTimeout(() => {
                if (tabId === 'recent-incomes') {
                    const table = document.getElementById('recentIncomesTable');
                    if (table) {
                        table.innerHTML = `
                            <tr>
                                <td>John Doe</td>
                                <td>$1,200</td>
                                <td>Salary</td>
                                <td>2024-01-15</td>
                            </tr>
                            <tr>
                                <td>Jane Smith</td>
                                <td>$800</td>
                                <td>Freelance</td>
                                <td>2024-01-14</td>
                            </tr>
                        `;
                    }
                } else if (tabId === 'recent-expenses') {
                    const table = document.getElementById('recentExpensesTable');
                    if (table) {
                        table.innerHTML = `
                            <tr>
                                <td>John Doe</td>
                                <td>$200</td>
                                <td>Groceries</td>
                                <td>2024-01-15</td>
                            </tr>
                            <tr>
                                <td>Jane Smith</td>
                                <td>$150</td>
                                <td>Utilities</td>
                                <td>2024-01-14</td>
                            </tr>
                        `;
                    }
                }
            }, 500);
        }
        
        function showError(message) {
            console.error('âŒ Error:', message);
            // Could show a toast or alert here
        }
        
        // Start initialization when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ðŸ“„ Dashboard DOM loaded');
            initializeDashboard();
        });
        
        // Global function for insights refresh button
        window.refreshInsights = function() {
            console.log('ðŸ’¡ Refreshing insights...');
            alert('Insights refreshed!');
        };
        
        // Make refreshInsightsBtn work
        const refreshInsightsBtn = document.getElementById('refreshInsightsBtn');
        if (refreshInsightsBtn) {
            refreshInsightsBtn.addEventListener('click', window.refreshInsights);
        }
        
    </script>
</body>
</html>
